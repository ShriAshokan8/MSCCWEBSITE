<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scores - MSC Competition</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>MSC Competition Scores</h1>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="2_about.html">About</a></li>
                <li><a href="3_events.html">Events</a></li>
                <li><a href="4_contact.html">Contact</a></li>
                <li><a href="5_scores.html">Scores</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <h2>Scores & Achievements</h2>

        <!-- Repeated sections for all tutor groups with Edit button -->

        <section>
            <h3>Outstanding Students from 7M1</h3>
            <ul>
                <li><strong>John D</strong> - Score: 85 <button class="edit-score" data-id="1">Edit</button></li>
                <li><strong>Jane S</strong> - Score: 82 <button class="edit-score" data-id="2">Edit</button></li>
                <li><strong>Sam J</strong> - Score: 78 <button class="edit-score" data-id="3">Edit</button></li>
                <li><strong>Emily S</strong> - Score: 75 <button class="edit-score" data-id="4">Edit</button></li>
                <li><strong>Michael B</strong> - Score: 70 <button class="edit-score" data-id="5">Edit</button></li>
            </ul>
        </section>

        <section>
            <h3>Outstanding Students from 7A1</h3>
            <ul>
                <li><strong>John D</strong> - Score: 85 <button class="edit-score" data-id="1">Edit</button></li>
                <li><strong>Jane S</strong> - Score: 82 <button class="edit-score" data-id="2">Edit</button></li>
                <li><strong>Sam J</strong> - Score: 78 <button class="edit-score" data-id="3">Edit</button></li>
                <li><strong>Emily S</strong> - Score: 75 <button class="edit-score" data-id="4">Edit</button></li>
                <li><strong>Michael B</strong> - Score: 70 <button class="edit-score" data-id="5">Edit</button></li>
            </ul>
        </section>

        <section>
            <h3>Outstanding Students from 7A2</h3>
            <ul>
                <li><strong>John D</strong> - Score: 85 <button class="edit-score" data-id="1">Edit</button></li>
                <li><strong>Jane S</strong> - Score: 82 <button class="edit-score" data-id="2">Edit</button></li>
                <li><strong>Sam J</strong> - Score: 78 <button class="edit-score" data-id="3">Edit</button></li>
                <li><strong>Emily S</strong> - Score: 75 <button class="edit-score" data-id="4">Edit</button></li>
                <li><strong>Michael B</strong> - Score: 70 <button class="edit-score" data-id="5">Edit</button></li>
            </ul>
        </section>

        <section>
            <h3>Outstanding Students from 7H1</h3>
            <ul>
                <li><strong>John D</strong> - Score: 85 <button class="edit-score" data-id="1">Edit</button></li>
                <li><strong>Jane S</strong> - Score: 82 <button class="edit-score" data-id="2">Edit</button></li>
                <li><strong>Sam J</strong> - Score: 78 <button class="edit-score" data-id="3">Edit</button></li>
                <li><strong>Emily S</strong> - Score: 75 <button class="edit-score" data-id="4">Edit</button></li>
                <li><strong>Michael B</strong> - Score: 70 <button class="edit-score" data-id="5">Edit</button></li>
            </ul>
        </section>

        <section>
            <h3>Outstanding Students from 7H2</h3>
            <ul>
                <li><strong>John D</strong> - Score: 85 <button class="edit-score" data-id="1">Edit</button></li>
                <li><strong>Jane S</strong> - Score: 82 <button class="edit-score" data-id="2">Edit</button></li>
                <li><strong>Sam J</strong> - Score: 78 <button class="edit-score" data-id="3">Edit</button></li>
                <li><strong>Emily S</strong> - Score: 75 <button class="edit-score" data-id="4">Edit</button></li>
                <li><strong>Michael B</strong> - Score: 70 <button class="edit-score" data-id="5">Edit</button></li>
            </ul>
        </section>

        <section>
            <h3>Outstanding Students from 7S1</h3>
            <ul>
                <li><strong>John D</strong> - Score: 85 <button class="edit-score" data-id="1">Edit</button></li>
                <li><strong>Jane S</strong> - Score: 82 <button class="edit-score" data-id="2">Edit</button></li>
                <li><strong>Sam J</strong> - Score: 78 <button class="edit-score" data-id="3">Edit</button></li>
                <li><strong>Emily S</strong> - Score: 75 <button class="edit-score" data-id="4">Edit</button></li>
                <li><strong>Michael B</strong> - Score: 70 <button class="edit-score" data-id="5">Edit</button></li>
            </ul>
        </section>

        <!-- Modal for Editing Scores -->
        <div id="edit-modal" class="modal">
            <div class="modal-content">
                <h2>Edit Score</h2>
                <label for="student-name">Name:</label>
                <input type="text" id="student-name" disabled>
                <label for="student-score">Score:</label>
                <input type="number" id="student-score">
                <button id="save-button">Save</button>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; <span id="currentYear"></span> MSC Competition | All rights reserved.</p>
    </footer>

    <!-- JavaScript for Dynamic Content and Admin Panel -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Initialization when DOM content is fully loaded
            console.log("The DOM has successfully loaded!");

            // Event listener for editing scores in the admin panel
            const editButtons = document.querySelectorAll('.edit-score');
            editButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    const studentId = e.target.dataset.id;
                    showEditModal(studentId);
                });
            });

            // Function to show the edit modal for a student
            function showEditModal(studentId) {
                const modal = document.querySelector("#edit-modal");
                modal.classList.add('visible');

                // Fetch student data by ID (mocked here)
                fetch(`/api/student/${studentId}`)
                    .then(response => response.json())
                    .then(data => {
                        document.querySelector("#student-name").value = data.name;
                        document.querySelector("#student-score").value = data.score;
                        document.querySelector("#save-button").dataset.id = studentId;
                    })
                    .catch(error => console.error("Error fetching student data:", error));
            }

            // Event listener for saving the edited score
            const saveButton = document.querySelector("#save-button");
            saveButton.addEventListener('click', async () => {
                const studentId = saveButton.dataset.id;
                const updatedScore = document.querySelector("#student-score").value;

                // Save the updated score to the database
                try {
                    const response = await fetch(`/api/student/${studentId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ score: updatedScore })
                    });

                    if (response.ok) {
                        alert("Score updated successfully!");
                        location.reload();  // Reload the page to update the displayed scores
                    } else {
                        alert("Error updating score");
                    }
                } catch (error) {
                    console.error("Error saving score:", error);
                }
            });

            // Close the modal if clicked outside
            const modal = document.querySelector("#edit-modal");
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('visible');
                }
            });

            // Inline script to display the current year in the footer
            document.getElementById("currentYear").textContent = new Date().getFullYear();
        });
    </script>
</body>
</html>
