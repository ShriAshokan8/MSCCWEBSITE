!function(){"use strict";class e{constructor(e){this.backdrop=document.getElementById(e),this.backdrop&&(this.modal=this.backdrop.querySelector(".modal"),this.closeBtn=this.backdrop.querySelector(".modal-close"),this.focusableElements=null,this.firstFocusable=null,this.lastFocusable=null,this.previousFocus=null,this.init())}init(){this.backdrop.addEventListener("click",e=>{e.target===this.backdrop&&this.close()}),this.closeBtn&&this.closeBtn.addEventListener("click",()=>this.close()),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.backdrop.classList.contains("active")&&this.close()})}open(){this.backdrop.classList.add("active"),document.body.style.overflow="hidden",this.previousFocus=document.activeElement,this.setFocusTrap(),this.firstFocusable&&this.firstFocusable.focus()}close(){this.backdrop.classList.remove("active"),document.body.style.overflow="",this.previousFocus&&this.previousFocus.focus()}setFocusTrap(){this.focusableElements=this.modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),0!==this.focusableElements.length&&(this.firstFocusable=this.focusableElements[0],this.lastFocusable=this.focusableElements[this.focusableElements.length-1],this.modal.addEventListener("keydown",e=>{"Tab"===e.key&&(e.shiftKey?document.activeElement===this.firstFocusable&&(e.preventDefault(),this.lastFocusable.focus()):document.activeElement===this.lastFocusable&&(e.preventDefault(),this.firstFocusable.focus()))}))}}class t{constructor(){this.container=this.createContainer()}createContainer(){let e=document.querySelector(".toast-container");return e||(e=document.createElement("div"),e.className="toast-container",document.body.appendChild(e)),e}show(e,t="info",o=5e3){const s=document.createElement("div");s.className=`toast alert alert-${t}`,s.setAttribute("role","alert"),s.setAttribute("aria-live","polite"),s.innerHTML=`\n                <span>${e}</span>\n                <button class="alert-close" aria-label="Close notification">Ã—</button>\n            `,this.container.appendChild(s);return s.querySelector(".alert-close").addEventListener("click",()=>this.remove(s)),o>0&&setTimeout(()=>this.remove(s),o),s}remove(e){e.style.animation="fadeOut 0.3s ease-out",setTimeout(()=>{e.parentElement&&this.container.removeChild(e)},300)}}function o(){document.querySelectorAll(".feedback-widget").forEach(e=>{const t=e.querySelectorAll(".feedback-btn"),o=e.querySelector(".feedback-message");t.forEach(e=>{e.addEventListener("click",function(){t.forEach(e=>e.classList.remove("selected")),this.classList.add("selected"),o&&(o.textContent="Thank you for your feedback!",o.style.display="block");const e=this.getAttribute("data-feedback");n("feedback_submitted",{feedback_type:e,page:window.location.pathname}),function(e){fetch("/api/feedback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({feedback:e,page:window.location.pathname,timestamp:(new Date).toISOString()})}).catch(e=>{console.log("Feedback submission (offline/not configured):",e)})}(e)})})})}function s(e){const t=e.value.trim(),o=e.type,s=e.hasAttribute("required");let n=!0,a="";e.classList.remove("error","success");const i=e.parentElement.querySelector(".form-error");if(i&&i.remove(),s&&!t)n=!1,a="This field is required";else if("email"===o&&t){/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)||(n=!1,a="Please enter a valid email address")}else if("url"===o&&t)try{new URL(t)}catch{n=!1,a="Please enter a valid URL"}const c=e.getAttribute("pattern");if(c&&t){new RegExp(c).test(t)||(n=!1,a=e.getAttribute("data-error-message")||"Invalid format")}if(n)t&&e.classList.add("success");else{e.classList.add("error");const t=document.createElement("span");t.className="form-error",t.textContent=a,t.setAttribute("role","alert"),e.parentElement.appendChild(t)}return n}function n(e,t={}){console.log("Analytics Event:",e,t),"undefined"!=typeof gtag&&gtag("event",e,t),"undefined"!=typeof ga&&ga("send","event",t.category||"engagement",e,t.label),"undefined"!=typeof fbq&&fbq("trackCustom",e,t),function(e,t){fetch("/api/analytics",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event:e,data:t,timestamp:(new Date).toISOString(),userAgent:navigator.userAgent})}).catch(e=>{console.log("Analytics event (offline/not configured):",e)})}(e,t)}window.toastManager=new t,document.addEventListener("DOMContentLoaded",function(){!function(){const e=document.querySelector(".back-to-top");e&&(window.addEventListener("scroll",()=>{window.pageYOffset>300?e.classList.add("visible"):e.classList.remove("visible")}),e.addEventListener("click",e=>{e.preventDefault();const t=window.matchMedia("(prefers-reduced-motion: reduce)").matches;window.scrollTo({top:0,behavior:t?"auto":"smooth"})}))}(),o(),document.querySelectorAll("form[data-validate]").forEach(e=>{const t=e.querySelectorAll(".form-input, .form-textarea, .form-select");t.forEach(e=>{e.addEventListener("blur",()=>s(e)),e.addEventListener("input",()=>{e.classList.contains("error")&&s(e)})}),e.addEventListener("submit",o=>{let a=!0;if(t.forEach(e=>{s(e)||(a=!1)}),a)n("form_submit",{form_name:e.getAttribute("name")||e.getAttribute("id"),page:window.location.pathname});else{o.preventDefault();const t=e.querySelector(".form-input.error, .form-textarea.error");t&&t.focus()}})}),document.querySelectorAll(".btn-primary, .btn-secondary, [data-track-cta]").forEach(e=>{e.addEventListener("click",function(){n("cta_click",{cta_text:this.textContent.trim(),cta_href:this.getAttribute("href")||"",cta_location:this.closest("section")?.id||"unknown",page:window.location.pathname})})}),document.querySelectorAll("[data-faq-item]").forEach(e=>{e.addEventListener("click",function(){const e=this.querySelector("h3, .faq-question")?.textContent.trim();n("faq_opened",{question:e,page:window.location.pathname})})}),document.querySelectorAll("[data-modal]").forEach(t=>{const o=t.getAttribute("data-modal"),s=new e(o);t.addEventListener("click",e=>{e.preventDefault(),s.open()})}),console.log("MSC Advanced Components initialized")}),window.MSCAdvanced={Modal:e,ToastManager:t,trackEvent:n}}();