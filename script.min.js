document.addEventListener('DOMContentLoaded',()=>{console.log("MSC Initiative website loaded successfully!");initializeBasicFeatures();initMSCRunningStopwatch();initScrollHeaderEffect();if('serviceWorker' in navigator){window.addEventListener('load',()=>{navigator.serviceWorker.register('/sw.js').then((registration)=>{console.log('Service Worker registered successfully:',registration.scope)}).catch((error)=>{console.log('Service Worker registration failed:',error)})})}});function initializeBasicFeatures(){console.log("Basic features initialized")}
function initScrollHeaderEffect(){const header=document.querySelector('header');if(!header)return;let lastScrollTop=0;let ticking=!1;function updateHeader(){const scrollTop=window.pageYOffset||document.documentElement.scrollTop;if(scrollTop>50){header.classList.add('scrolled')}else{header.classList.remove('scrolled')}
lastScrollTop=scrollTop;ticking=!1}
window.addEventListener('scroll',()=>{if(!ticking){window.requestAnimationFrame(updateHeader);ticking=!0}},{passive:!0});updateHeader()}
function zonedUKToUtc({year,month,day,hour=0,minute=0,second=0}){const timeZone='Europe/London';if(typeof Intl==='undefined'||!Intl.DateTimeFormat||!Intl.DateTimeFormat().resolvedOptions().timeZone){return new Date(year,month-1,day,hour,minute,second).getTime()}
const localAsUTC=Date.UTC(year,month-1,day,hour,minute,second);const dtf=new Intl.DateTimeFormat('en-GB',{timeZone,year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:!1});const parts=dtf.formatToParts(new Date(localAsUTC));const map={};for(const p of parts)map[p.type]=p.value;const asUTCFromZoned=Date.UTC(Number(map.year),Number(map.month)-1,Number(map.day),Number(map.hour),Number(map.minute),Number(map.second));const offset=asUTCFromZoned-localAsUTC;return localAsUTC-offset}
function setValueWithTick(el,newText){if(!el)return;if(el.textContent===newText)return;el.textContent=newText;el.classList.remove('ticking');el.offsetWidth;el.classList.add('ticking')}
function initMSCRunningStopwatch(){const root=document.getElementById('mscStopwatch');if(!root)return;const START_UK={year:2024,month:9,day:23,hour:17,minute:3,second:37};const startMs=zonedUKToUtc(START_UK);const weeksEl=root.querySelector('.value[data-unit="weeks"]');const daysEl=root.querySelector('.value[data-unit="days"]');const hoursEl=root.querySelector('.value[data-unit="hours"]');const minsEl=root.querySelector('.value[data-unit="minutes"]');const secsEl=root.querySelector('.value[data-unit="seconds"]');const liveRegion=document.getElementById('mscStartNote');const pad2=(n)=>String(n).padStart(2,'0');let lastAnnouncedMinute=null;function update(){const nowMs=Date.now();let diffSec=Math.floor((nowMs-startMs)/1000);if(diffSec<0){diffSec=0}
const totalDays=Math.floor(diffSec/86400);const weeks=Math.floor(totalDays/7);const days=totalDays%7;const rem=diffSec%86400;const hours=Math.floor(rem/3600);const rem2=rem-hours*3600;const minutes=Math.floor(rem2/60);const seconds=rem2-minutes*60;setValueWithTick(weeksEl,String(weeks));setValueWithTick(daysEl,String(days));setValueWithTick(hoursEl,pad2(hours));setValueWithTick(minsEl,pad2(minutes));setValueWithTick(secsEl,pad2(seconds));const totalMinutes=totalDays*24*60+hours*60+minutes;if(liveRegion&&totalMinutes!==lastAnnouncedMinute){liveRegion.textContent=`MSC has been running for ${weeks} week${weeks === 1 ? '' : 's'}, `+`${days} day${days === 1 ? '' : 's'}, `+`${hours} hour${hours === 1 ? '' : 's'} and `+`${minutes} minute${minutes === 1 ? '' : 's'}. `+`Started on the 23rd of September 2024 at 17:03:37 UK time (Europe/London).`;lastAnnouncedMinute=totalMinutes}}
update();setInterval(update,1000)}
